import{g as o,f as m,a as C,r as n}from"./useFetch-CPNCRhkP.js";const f=o(".bag__add.btn.black"),l=o(".bag__list"),c=o(".pop-up__list"),g=o(".summ span span");class b{clotherInfo;cart;lastClickTime=0;constructor(){this.clotherInfo=null,this.cart=this.loadCart(),this.init()}init(){f&&f.addEventListener("click",()=>{this.handleAddToBagClick()}),this.renderCart()}handleAddToBagClick(){const t=Date.now();t-this.lastClickTime<3e3||(this.lastClickTime=t,this.conectDb())}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const a=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,s=await m(a,{method:"GET"});if(s.error){console.error("Error fetching document:",s.error);return}s.data&&(this.clotherInfo={id:t,data:s.data.fields},this.addToList())}addToList(){if(this.clotherInfo&&l){const t=this.clotherInfo.id,e=this.selectedSize(),a=parseFloat(this.clotherInfo.data.cost.stringValue.replace(",",".")),s=Number(this.count()[0]),i=this.cart.find(r=>r.id===t&&r.size===e);l.classList.contains("active")||l.classList.add("active"),i?(i.quantity+=s,i.price+=a*s):this.cart.push({id:t,size:e,quantity:s,price:a*s,data:this.clotherInfo.data}),this.saveCart(),this.renderCart()}}selectedSize(){const t=C(".sizes__list label"),e=[];return t&&t.forEach(s=>{const i=s.querySelector('input[type="radio"]');i&&i.checked&&e.push(s)}),e.length==0&&this.clotherInfo?.data?this.clotherInfo.data.size.arrayValue.values[0].stringValue:e[0].textContent?.trim().replace(/[\s]+$/,"")}count(){const t=o("#buttonCountNumber")?.innerText,e=o("#calculation")?.innerText;return[t,e]}renderCart(){if(c){if(c.innerHTML="",this.cart.length===0){const t=n("p","empty-cart-message");t.textContent="Your bag is empty.",c?.appendChild(t)}else this.cart.forEach(t=>{const e=n("div","prod-in-bag"),a=n("a",["clother",t.id,t.size]);a.href=`one-product.html?id=${t.id}`;const s=n("div","clother__img");s.innerHTML=`
          <picture>
            <source srcset=${t.data.imgWebP.stringValue} type="image/webp" />
            <img src=${t.data.img.stringValue} />
          </picture>
        `;const i=n("div","clother__info"),r=n("p","clother__name");r.textContent=t.data.name.stringValue;const d=n("p","clother__size");d.innerHTML=`Size: <span>${t.size}</span>`;const h=n("p","clother__art");h.innerHTML=`
          Art.No.: <span>434536465<span>
        `;const p=n("p","clother__count");p.innerHTML=`
          ${t.quantity} x ${(t.price/t.quantity).toFixed(2)} EUR
        `;const u=n("div","clother__remove");u.innerHTML=`
          <svg>
            <use href="#remove"></use>
          </svg>
        `,i.appendChild(r),i.appendChild(d),i.appendChild(h),i.appendChild(p),a.appendChild(s),a.appendChild(i),e.appendChild(a),e.appendChild(u),c.appendChild(e),this.removeClother(e,t)});this.updateTotal()}}removeClother(t,e){const a=t.querySelector(".clother__remove");a&&a.addEventListener("click",()=>{this.cart=this.cart.filter(s=>s.id!==e.id||s.size!==e.size),t.remove(),this.saveCart(),this.updateTotal()})}updateTotal(){const t=this.cart.reduce((e,a)=>e+a.price,0);g&&(g.textContent=t.toFixed(2))}saveCart(){localStorage.setItem("shoppingCart",JSON.stringify(this.cart))}loadCart(){const t=localStorage.getItem("shoppingCart");return t?JSON.parse(t):[]}}export{b as A};
