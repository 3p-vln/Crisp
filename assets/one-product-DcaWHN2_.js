import{g as l,a as b,f as u,r}from"./useFetch-CPNCRhkP.js";import{B as T,A as S,S as B}from"./search-DbR8hu1i.js";import{L as w}from"./stop-preload-lHMBXtTV.js";import{P as V,S as U}from"./pop-up-closer-BmjNRtmD.js";import{S as D,A as $}from"./autoplay-CXgkKXRk.js";import{P as k}from"./pagination-ci0mCzHu.js";import{T as P}from"./tabs-YtMPvNz6.js";import{L as j}from"./you-may-also-like-CE_fieVy.js";import{A}from"./add-to-bag-D7o2r1jJ.js";D.use([k,$]);const f=l(".main-img__swiper-wrapper"),g=l(".main-info__all-img");class M{swiper;slidesArr;constructor(){this.swiper=null,this.slidesArr=null,this.init().then(()=>w.stop("main-info__tabs"))}async init(){this.conectDb()}initSwiper(){if(b(".main-img__slide").length>1)this.swiper=new D(".main-img__swiper",{slidesPerView:1,autoplay:{delay:1e4},pagination:{el:".swiper-pagination"},grabCursor:!0,on:{slideChange:()=>this.onSlideChange()}}),this.initTabsSync();else{const s=l(".main-img__swiper");s&&s.classList.remove("swiper-container-initialized","swiper-container-horizontal")}}initTabsSync(){b(".tabs__nav-btn").forEach((s,n)=>{s.addEventListener("click",()=>{this.swiper&&this.swiper.slideTo(n)})})}onSlideChange(){b(".tabs__nav-btn").forEach((s,n)=>{this.swiper&&n===this.swiper.realIndex?s.classList.add("tabs__nav-btn_active"):s.classList.remove("tabs__nav-btn_active")})}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const n=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,e=await u(n,{method:"GET"});if(e.error){console.error("Error fetching document:",e.error);return}e.data&&(this.slidesArr=e.data.fields,this.renderSlides(),this.initSwiper(),w.stop("main-img__slide"),w.stop("tabs__nav-btn"),new P)}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}renderSlides(){if(f&&g&&this.slidesArr){const{img:t,subImg1:s,subImg2:n,subImgWebP1:e,subImgWebP2:o}=this.slidesArr;if(t&&s&&n&&e&&o){const i=r("button",["tabs__nav-btn","tabs__nav-btn_active","skeleton"]);i.type="button",i.dataset.tab="#slide-1",i.innerHTML=`
          <img src="${t.stringValue}" />
        `;const a=r("button",["tabs__nav-btn","skeleton"]);a.type="button",a.dataset.tab="#slide-2",a.innerHTML=`
          <img src="${s.stringValue}" />
        `;const d=r("button",["tabs__nav-btn","skeleton"]);d.type="button",d.dataset.tab="#slide-3",d.innerHTML=`
          <img src="${n.stringValue}" />
        `,g.appendChild(i),g.appendChild(a),g.appendChild(d);const p=r("div",["main-img__slide","swiper-slide","tabs__item","tabs__item_active","skeleton"]);p.id="slide-1",p.innerHTML=`
          <img src="${t.stringValue}" />
        `;const m=r("div",["main-img__slide","swiper-slide","tabs__item","skeleton"]);m.id="slide-2",m.innerHTML=`
          <img src="${s.stringValue}" />
        `;const c=r("div",["main-img__slide","swiper-slide","tabs__item","skeleton"]);c.id="slide-3",c.innerHTML=`
          <img src="${n.stringValue}" />
        `,f.appendChild(p),f.appendChild(m),f.appendChild(c)}else if(t?.stringValue!=null){const i=r("button",["tabs__nav-btn","tabs__nav-btn_active","skeleton"]);i.type="button",i.dataset.tab="#slide-1",i.innerHTML=`
          <img src="${t.stringValue}" />
        `,g.appendChild(i);const a=r("div",["main-img__slide","swiper-slide","tabs__item","tabs__item_active"]);a.id="slide-1",a.innerHTML=`
          <img src="${t.stringValue}" />
        `,f.appendChild(a)}}}}class W{calculation;countElement;calculationElement;buttonCountPlus;buttonCountMinus;clotherInfo;constructor(){this.clotherInfo=null,this.calculationElement=document.getElementById("calculation"),this.countElement=document.getElementById("buttonCountNumber"),this.buttonCountPlus=document.getElementById("buttonCountPlus"),this.buttonCountMinus=document.getElementById("buttonCountMinus"),this.calculation=0,this.buttonCountPlus.onclick=this.incrementCount.bind(this),this.buttonCountMinus.onclick=this.decrementCount.bind(this),this.conectDb()}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const n=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,e=await u(n,{method:"GET"});if(e.error){console.error("Error fetching document:",e.error);return}if(e.data&&(this.clotherInfo=e.data.fields,this.clotherInfo.cost?.stringValue)){const o=this.clotherInfo.cost.stringValue,i=parseFloat(o.replace(",","."));isNaN(i)||(this.calculation=i,this.updateCalculation(+this.countElement.innerHTML))}}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}incrementCount(){let t=+this.countElement.innerHTML;t<999&&(t++,this.countElement.innerHTML=t.toString(),this.updateCalculation(t))}decrementCount(){let t=+this.countElement.innerHTML;t>1&&(t--,this.countElement.innerHTML=t.toString(),this.updateCalculation(t))}updateCalculation(t){const s=this.calculation*t;this.calculationElement.innerHTML=this.formatPrice(s)}formatPrice(t){return t.toFixed(2).replace(".",",")}}class R{dropdownBtn;dropdownList;dropdownBtnInfo;radioButtons;constructor(t){this.dropdownBtn=l(`${t} .dropdown__btn`),this.dropdownList=l(`${t} .dropdown__list`),this.dropdownBtnInfo=this.dropdownBtn.querySelector(".dropdown__btn_info"),this.radioButtons=this.dropdownList.querySelectorAll('input[type="radio"]'),this.init()}init(){this.dropdownBtn.addEventListener("click",()=>this.toggleDropdown()),this.radioButtons.forEach(t=>t.addEventListener("change",()=>this.updateDropdown(t))),window.addEventListener("resize",()=>this.checkScreenWidth()),this.checkScreenWidth()}toggleDropdown(){this.dropdownList.classList.toggle("active"),this.dropdownBtn.classList.toggle("active")}updateDropdown(t){const s=t.parentElement;if(s){const n=s.textContent?.trim().replace(/[\s]+$/,"")??"Size";this.dropdownBtnInfo.textContent=n}else this.dropdownBtnInfo.textContent="Size";this.dropdownList.classList.remove("active"),this.dropdownBtn.classList.remove("active")}checkScreenWidth(){window.innerWidth>1024?(this.dropdownList.classList.add("active"),this.dropdownBtn.classList.add("active")):(this.dropdownList.classList.remove("active"),this.dropdownBtn.classList.remove("active"))}}const C=l(".info__brand p"),I=l(".info__title"),v=b(".info__color-btns"),L=b(".sizes__list label"),E=l(".price__total span");class H{clotherInfo;constructor(){this.clotherInfo=null,this.init().then(()=>w.stop("main-info__info"))}async init(){this.conectDb()}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const n=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,e=await u(n,{method:"GET"});if(e.error){console.error("Error fetching document:",e.error);return}e.data&&(this.clotherInfo=e.data.fields,this.updateUI())}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}updateUI(){this.brandAndTitle(),this.colors(),this.size(),this.price()}brandAndTitle(){C&&I&&(this.clotherInfo?(C.textContent=this.clotherInfo.brand?.stringValue||"No brand",I.textContent=this.clotherInfo.name?.stringValue||"No title"):(C.textContent="No brand",I.textContent="No title"))}colors(){this.clotherInfo?.color?.arrayValue?.values&&this.clotherInfo.color.arrayValue.values.forEach(t=>{v&&v.forEach(s=>{const n=r("div",["color",`color__${t.stringValue}`]),e=r("input",null);e.type="radio",e.name="color",e.id=t.stringValue;const o=r("div","custom-radio");n.appendChild(e),n.appendChild(o),s.appendChild(n)})})}size(){this.clotherInfo?.size?.arrayValue?.values&&this.clotherInfo.size.arrayValue.values.forEach(t=>{const s=t.stringValue?.trim();s&&L&&L.forEach(n=>{n.textContent?.trim()===s&&n.classList.remove("no-size")})})}price(){if(E&&this.clotherInfo?.cost?.stringValue){const s=this.clotherInfo.cost.stringValue.split(" ")[0];E.textContent=s}}}const h=l(".bag__save"),y="#eb5757";class x{uid;currentUser;currentClother;constructor(){this.currentUser=null,this.uid=this.getCookie("UID"),this.currentClother=null,this.init()}init(){this.conectUserDb(),h&&h.addEventListener("click",()=>{this.addToWishlistDb()})}getCookie(t){const n=`; ${document.cookie}`.split(`; ${t}=`);if(n.length===2)return n.pop()?.split(";").shift()}async conectUserDb(){if(!this.uid){console.error("UID not found"),window.location.href="/Crisp/sign-in.html";return}const t={projectId:"crisp-b06bf"},s={structuredQuery:{from:[{collectionId:"users"}],where:{fieldFilter:{field:{fieldPath:"uid"},op:"EQUAL",value:{stringValue:this.uid}}}}},n=`https://firestore.googleapis.com/v1/projects/${t.projectId}/databases/(default)/documents:runQuery`;try{const e=await u(n,{method:"POST",body:s});if(e.error){console.error("Error fetching data:",e.error);return}if(e.data&&e.data.length>0){const o=e.data[0];if(o.document&&o.document.fields){const i=o.document.name.split("/").pop()||"";this.currentUser={id:i,data:o.document.fields}}this.getCurrentClotherDB()}}catch(e){console.error("Error fetching data:",e)}}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}async getCurrentClotherDB(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const n=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,e=await u(n,{method:"GET"});if(e.error){console.error("Error fetching document:",e.error);return}e.data&&(this.currentClother={id:t,data:e.data.fields},this.checkWishlistStatus())}async checkWishlistStatus(){if(!this.currentUser||!this.currentClother){console.error("Current user or clothing item is not defined");return}const t={projectId:"crisp-b06bf"},s=this.currentUser.id,n=this.currentClother.id,e=`https://firestore.googleapis.com/v1/projects/${t.projectId}/databases/(default)/documents/users/${s}`,o=await u(e,{method:"GET"});if(o.error||!o.data){console.error("Error fetching current wishlist:",o.error);return}(o.data.fields.wishlist?.arrayValue?.values||[]).some(d=>d.stringValue===n)&&h&&(h.style.backgroundColor=y,h.style.borderColor=y,h.style.pointerEvents="none")}async addToWishlistDb(){if(!this.currentUser||!this.currentClother){console.error("Current user or clothing item is not defined");return}const t={projectId:"crisp-b06bf"},s=this.currentUser.id,n=this.currentClother.id,e=`https://firestore.googleapis.com/v1/projects/${t.projectId}/databases/(default)/documents/users/${s}`,o=await u(e,{method:"GET"});if(o.error||!o.data){console.error("Error fetching current wishlist:",o.error);return}const i=o.data.fields.wishlist?.arrayValue?.values||[];if(i.some(c=>c.stringValue===n)){this.checkWishlistStatus();return}const d=[...i,{stringValue:n}],p=`https://firestore.googleapis.com/v1/projects/${t.projectId}/databases/(default)/documents/users/${s}?updateMask.fieldPaths=wishlist`,m={fields:{wishlist:{arrayValue:{values:d}}}};try{const c=await u(p,{method:"PATCH",body:m});if(c.error){console.error("Error updating wishlist:",c.error);return}}catch(c){console.error("Error updating wishlist:",c)}}}document.addEventListener("DOMContentLoaded",async()=>{new T,new S,new A,new M,new W,new R(".info__sizes"),new H,new j,w.stop("more-info"),new B,new x,new V(".buy__bag",".bag__list")});new U;
