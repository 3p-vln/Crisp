import{g as n,a as h,f as c,B as p,A as f}from"./useFetch-DucEEeGt.js";import{A as g,S as m}from"./add-to-bag-D9VxPnbD.js";import{S as b}from"./search-Gn1DJGtm.js";import{T as w}from"./tabs-3kbno4Ih.js";import{J as v}from"./just-validate.es-C73wyOde.js";class D{title;breadCrumbs;observer;constructor(){this.title=n(".title__content h2"),this.breadCrumbs=h(".bread-crumbs a")[1],this.updateTitle(),this.observer=new MutationObserver(()=>this.updateTitle());const t={attributes:!0,attributeFilter:["class"],subtree:!0};document.querySelectorAll(".tabs__nav-btn").forEach(o=>{this.observer.observe(o,t),o.addEventListener("click",s=>{s.preventDefault(),this.setActiveTab(o),this.updateUrl(o)})}),this.initActiveTab()}updateTitle(){this.title&&this.breadCrumbs&&(this.title.textContent=this.getActiveTabTitle(),this.breadCrumbs.textContent=this.getActiveTabTitle())}getActiveTabTitle(){const t=n(".tabs__nav-btn_active");return t&&t.textContent||""}setActiveTab(t){document.querySelectorAll(".tabs__nav-btn").forEach(a=>a.classList.remove("tabs__nav-btn_active")),t.classList.add("tabs__nav-btn_active");const o=t.getAttribute("data-tab"),s=n(o);document.querySelectorAll(".tabs__item").forEach(a=>a.classList.remove("tabs__item_active")),s&&s.classList.add("tabs__item_active"),this.updateTitle()}updateUrl(t){const e=t.getAttribute("data-tab")?.substring(1);e&&history.pushState(null,"",`#${e}`)}initActiveTab(){const t=window.location.hash;if(t){const e=document.querySelector(`.tabs__nav-btn[data-tab="${t}"]`);e&&this.setActiveTab(e)}else{const e=document.querySelector(".tabs__nav-btn");e&&this.setActiveTab(e)}}}class y{userData;uid;constructor(){this.uid=this.getCookie("UID"),this.init()}init(){console.log(this.uid),this.conectDb()}getCookie(t){const o=`; ${document.cookie}`.split(`; ${t}=`);if(o.length===2)return o.pop()?.split(";").shift()}async conectDb(){if(!this.uid){console.error("UID not found");return}const t={projectId:"crisp-b06bf"},e={structuredQuery:{from:[{collectionId:"users"}],where:{fieldFilter:{field:{fieldPath:"uid"},op:"EQUAL",value:{stringValue:this.uid}}}}},o=`https://firestore.googleapis.com/v1/projects/${t.projectId}/databases/(default)/documents:runQuery`,s=await c(o,{method:"POST",body:e});if(s.error){console.error("Error fetching data:",s.error);return}if(s.data&&s.data.length>0){const r=s.data[0];r.document&&r.document.fields&&(this.userData=r.document.fields,console.log(this.userData),this.updateUi())}}updateUi(){this.contactInfo(),this.billing(),this.shoppingAdress()}contactInfo(){if(!this.userData)return;const t=n(".full-name");t&&(t.innerHTML=`${this.userData.name.stringValue} ${this.userData.surname.stringValue}`);const e=n(".email");e&&(e.innerHTML=this.userData.email.stringValue)}async billing(){if(this.userData&&this.userData.billing?.stringValue){const t=this.userData.billing.stringValue;let e=null;const s=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/billing/${t}`,r=await c(s);if(r.error){console.error("Ошибка при загрузке данных:",r.error);return}if(r.data){e=r.data.fields;const a=n(".billing-address");a&&(a.innerHTML=`${e.country.stringValue}, ${e.city.stringValue}, ${e.street.stringValue} street`)}}}async shoppingAdress(){if(this.userData&&this.userData.shoppingAddress?.stringValue){const t=this.userData.shoppingAddress.stringValue;let e=[];const s=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/shopping-address/${t}/allUserAddress`,r=await c(s);if(r.error){console.error("Ошибка при загрузке данных:",r.error);return}if(console.log("Response data:",r.data),r.data&&Array.isArray(r.data.documents)){r.data.documents.forEach(i=>{i.fields&&e.push(i.fields)});const a=n(".shopping-address");if(a&&e.length>0){const i=e[0];a.innerHTML=`${i.phone.stringValue}<br>${i.country.stringValue}, ${i.city.stringValue}, ${i.street.stringValue} street, ${i.zip.stringValue}`}}else console.error("Response data is not in the expected format:",r.data)}}}class _{userData;uid;constructor(){this.uid=this.getCookie("UID"),this.init()}init(){console.log(this.uid),this.conectDb(),this.setupEventListeners()}getCookie(t){const o=`; ${document.cookie}`.split(`; ${t}=`);if(o.length===2)return o.pop()?.split(";").shift()}async conectDb(){if(!this.uid){console.error("UID not found");return}const t={projectId:"crisp-b06bf"},e={structuredQuery:{from:[{collectionId:"users"}],where:{fieldFilter:{field:{fieldPath:"uid"},op:"EQUAL",value:{stringValue:this.uid}}}}},o=`https://firestore.googleapis.com/v1/projects/${t.projectId}/databases/(default)/documents:runQuery`;try{const s=await c(o,{method:"POST",body:e});if(s.error){console.error("Error fetching data:",s.error);return}if(s.data&&s.data.length>0){const r=s.data[0];r.document&&r.document.fields&&(this.userData=r.document.fields,this.uid=r.document.name.split("/").pop(),console.log(this.userData),this.updateUi())}}catch(s){console.error("Error fetching data:",s)}}updateUi(){const t=h(".form__item-input");t&&t.forEach(e=>{e.id==="name"&&this.userData?e.value=this.userData.name.stringValue:e.id==="surname"&&this.userData&&(e.value=this.userData.surname.stringValue)})}setupEventListeners(){const t=n(".form__button .save");t&&t.addEventListener("click",e=>{e.preventDefault(),this.updateData()})}async updateData(){const t=n("#name").value,e=n("#surname").value;if(!this.uid){console.error("UID not found");return}console.log("Updating data for UID:",this.uid),console.log("New name:",t),console.log("New surname:",e);const o={projectId:"crisp-b06bf"},s=`users/${this.uid}`,r=`https://firestore.googleapis.com/v1/projects/${o.projectId}/databases/(default)/documents/${s}?updateMask.fieldPaths=name&updateMask.fieldPaths=surname`,a={fields:{name:{stringValue:t},surname:{stringValue:e}}};console.log("Request URL:",r),console.log("Request body:",a);try{const i=await c(r,{method:"PATCH",body:a});if(i.error){console.error("Error updating data:",i.error);return}console.log("Data updated successfully:",i.data)}catch(i){console.error("Error updating data:",i)}}}class A{dropdownSelect;dropdownMenu;menuItems;constructor(t,e){const o=n(t),s=n(e);if(!o||!s)throw new Error("Dropdown select or menu element not found");this.dropdownSelect=o,this.dropdownMenu=s,this.menuItems=this.dropdownMenu.querySelectorAll(".tabs__nav-btn"),this.init()}init(){window.innerWidth<=768&&this.setupDropdown(),window.addEventListener("resize",()=>{window.innerWidth<=768?this.setupDropdown():this.teardownDropdown()}),this.dropdownSelect.addEventListener("click",()=>{this.toggleMenu()}),this.menuItems.forEach(t=>{t.addEventListener("click",()=>{this.selectItem(t)})})}setupDropdown(){this.dropdownMenu.classList.add("drop-down__menu"),this.dropdownMenu.classList.add("hidden");const t=this.dropdownMenu.querySelector(".tabs__nav-btn_active");t&&t.textContent&&(this.dropdownSelect.textContent=t.textContent.trim())}teardownDropdown(){this.dropdownMenu.classList.remove("drop-down__menu"),this.dropdownMenu.classList.remove("hidden")}toggleMenu(){this.dropdownSelect.classList.toggle("active"),this.dropdownMenu.classList.toggle("hidden")}selectItem(t){this.menuItems.forEach(e=>e.classList.remove("tabs__nav-btn_active")),t.classList.add("tabs__nav-btn_active"),t.textContent&&(this.dropdownSelect.textContent=t.textContent.trim()),this.toggleMenu()}}class C{uid;constructor(){this.uid=this.getCookie("UID"),this.init()}init(){if(console.log(this.uid),!this.uid){window.location.href="/Crisp/index.html";return}}getCookie(t){const o=`; ${document.cookie}`.split(`; ${t}=`);if(o.length===2)return o.pop()?.split(";").shift()}}const l=n(".drop-down#state");class u{dropdownSelect;dropdownMenu;menuItems;constructor(t,e){const o=n(t),s=n(e);if(!o||!s)throw new Error("Dropdown select or menu element not found");this.dropdownSelect=o,this.dropdownMenu=s,this.menuItems=this.dropdownMenu.querySelectorAll(".drop-down__item"),this.init()}init(){this.dropdownSelect.addEventListener("click",t=>this.toggleMenu(t)),this.menuItems.forEach(t=>{t.addEventListener("click",()=>this.onItemClick(t))}),document.addEventListener("click",t=>this.handleOutsideClick(t)),this.dropdownMenu.classList.add("hidden")}onItemClick(t){const e=t.textContent;e&&(this.dropdownSelect.textContent=e,this.teardownDropdown(),this.updateStateDropdown(e))}updateStateDropdown(t){const e=this.getStatesByCountry(t);if(!l){console.error("State dropdown element not found");return}const o=l.querySelector(".drop-down__select");o&&(o.textContent="");const s=l.querySelector(".drop-down__list");s&&(s.innerHTML="",e.forEach(a=>{const i=document.createElement("div");i.classList.add("drop-down__item"),i.textContent=a,s.appendChild(i)}),s.querySelectorAll(".drop-down__item").forEach(a=>{a.addEventListener("click",()=>{if(!l){console.error("State dropdown element not found");return}const i=l.querySelector(".drop-down__select");i&&(i.textContent=a.textContent),this.teardownDropdown()})}))}getStatesByCountry(t){return{Ukraine:["Kyiv","Kharkiv","Odessa","Sumy","Zhytomyr","Lviv"],USA:["California","New York","Texas"],Canada:["Ontario","Quebec","British Columbia"]}[t]||[]}teardownDropdown(){this.dropdownMenu.classList.add("hidden"),this.dropdownSelect.classList.remove("active")}toggleMenu(t){t.stopPropagation(),this.dropdownSelect.classList.toggle("active"),this.dropdownMenu.classList.toggle("hidden")}handleOutsideClick(t){!this.dropdownSelect.contains(t.target)&&!this.dropdownMenu.contains(t.target)&&this.teardownDropdown()}}const I=n(".add-address__save");class L{userData;newAddressDb;uid;constructor(){this.newAddressDb=null,this.userData=null,this.uid=this.getCookie("UID"),this.init()}init(){I?.addEventListener("click",()=>{this.fieldsDb(),this.conectDb()})}fieldsDb(){const t=n("#company").value,e=n("#phone").value,o=n("#fax").value,s=n("#street").value,r=n("#country .drop-down__select")?.innerText,a=n("#state .drop-down__select")?.innerText,i=n("#zip").value;this.newAddressDb={country:{stringValue:r||""},city:{stringValue:a||""},street:{stringValue:s},zip:{stringValue:i},phone:{stringValue:e}},t&&(this.newAddressDb.company={stringValue:t}),o&&(this.newAddressDb.fax={stringValue:o}),console.log(this.newAddressDb)}getCookie(t){const o=`; ${document.cookie}`.split(`; ${t}=`);if(o.length===2)return o.pop()?.split(";").shift()}async conectDb(){if(!this.uid){console.error("UID not found");return}const t={projectId:"crisp-b06bf"},e={structuredQuery:{from:[{collectionId:"users"}],where:{fieldFilter:{field:{fieldPath:"uid"},op:"EQUAL",value:{stringValue:this.uid}}}}},o=`https://firestore.googleapis.com/v1/projects/${t.projectId}/databases/(default)/documents:runQuery`;try{const s=await c(o,{method:"POST",body:e});if(s.error){console.error("Error fetching data:",s.error);return}if(s.data&&s.data.length>0){const r=s.data[0];r.document&&r.document.fields&&(this.userData=r.document.fields,this.uid=r.document.name.split("/").pop()),console.log(this.userData),this.addToDb()}}catch(s){console.error("Error fetching data:",s)}}async addToDb(){if(this.userData&&this.userData.shoppingAddress?.stringValue){const t=this.userData.shoppingAddress.stringValue;if(console.log(t),!this.uid){console.error("UID not found");return}const o=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/shopping-address/${t}/allUserAddress`;if(this.newAddressDb){const s={fields:{country:this.newAddressDb.country,city:this.newAddressDb.city,street:this.newAddressDb.street,zip:this.newAddressDb.zip,phone:this.newAddressDb.phone,...this.newAddressDb.company&&{company:this.newAddressDb.company},...this.newAddressDb.fax&&{fax:this.newAddressDb.fax}}};try{const r=await c(o,{method:"POST",body:s});if(r.error){console.error("Error adding document:",r.error);return}r.data&&console.log("Document written with ID:",r.data.name)}catch(r){console.error("Error adding address:",r)}}}}}class S{form;constructor(){const t=n(".contact__form .form"),e=n(".address__form .form");t&&e?this.form=[t,e]:this.form=null,this.form&&this.init()}init(){this.form&&this.form.forEach(t=>{const e=new v(t,{errorLabelStyle:{color:"#1D1F21"}});e.addField(n("#phone"),[{rule:"required",errorMessage:"Enter your phone"},{rule:"customRegexp",value:/^\+\d{1,3}\d{9}$/,errorMessage:"Write correct phone"},{rule:"minLength",value:10,errorMessage:"Min lendth 10 symbol"},{rule:"maxLength",value:15,errorMessage:"Max lendth 15 symbol"}]).addField(n("#street"),[{rule:"required",errorMessage:"Enter your street"},{rule:"customRegexp",value:/^[-\w.]+$/i,errorMessage:"Write correct street"}]).addField(n("#country"),[{rule:"required",errorMessage:"Chose your country"}]).addField(n("#zip"),[{rule:"required",errorMessage:"Enter your zip code"},,{rule:"customRegexp",handler:o=>/^\d{5}$/.test(o),errorMessage:"Write correct zip code"}]),e.onSuccess(()=>{console.log("Form is valid"),new L})})}}class E{button;container;constructor(t,e){this.button=n(t),this.container=n(e),this.button.addEventListener("click",this.toggleContent.bind(this))}toggleContent(){this.container?.classList.toggle("show-content")}}document.addEventListener("DOMContentLoaded",async()=>{new C,new p,new b,new g,new f,new w,new D,new y,new _,new A(".drop-down__select",".tabs"),new u(".drop-down#country .drop-down__select",".drop-down#country .drop-down__list"),new u(".drop-down#state .drop-down__select",".drop-down#state .drop-down__list"),new S,new E(".contact-us__btn",".contact-us")});new m;
