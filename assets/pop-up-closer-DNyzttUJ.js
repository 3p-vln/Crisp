import{a as d,g as n,f as v,r as a}from"./search-DP2q2jjU.js";class I{allSkeleton;constructor(){this.allSkeleton=d(".skeleton"),this.removeSkeleton()}removeSkeleton(){document.addEventListener("loadingIsFinished",t=>{this.allSkeleton=d(".skeleton");let e=0;if(t.detail){const o=document.querySelectorAll("."+t.detail.block+" img");o.length==0&&this.removeClassname(t),o.forEach(s=>{s.complete&&(e+=1,t.detail?.requiredImagesCount&&e>=t.detail.requiredImagesCount&&this.removeClassname(t)),s.onload=()=>{e+=1,t.detail?.requiredImagesCount&&e>=t.detail.requiredImagesCount&&this.removeClassname(t)}})}})}removeClassname(t){this.allSkeleton.forEach(e=>{t.detail?.block&&e.classList.contains(t.detail.block)&&e.classList.remove("skeleton")})}}const g=n(".bag__add.btn.black"),l=n(".bag__list"),c=n(".pop-up__list"),C=n(".summ span span");class _{clotherInfo;cart;constructor(){this.clotherInfo=null,this.cart=this.loadCart(),this.init()}init(){g&&g.addEventListener("click",()=>{this.conectDb()}),this.renderCart()}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const o=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,s=await v(o,{method:"GET"});if(s.error){console.error("Error fetching document:",s.error);return}s.data&&(this.clotherInfo={id:t,data:s.data.fields},console.log(this.clotherInfo),this.addToList())}addToList(){if(this.clotherInfo&&l){const t=this.clotherInfo.id,e=this.selectedSize(),o=parseFloat(this.clotherInfo.data.cost.stringValue.replace(",",".")),s=Number(this.count()[0]),i=this.cart.find(r=>r.id===t&&r.size===e);l.classList.contains("active")||l.classList.add("active"),i?(i.quantity+=s,i.price+=o*s):this.cart.push({id:t,size:e,quantity:s,price:o*s,data:this.clotherInfo.data}),this.saveCart(),this.renderCart()}}selectedSize(){const t=d(".sizes__list label"),e=[];if(t&&t.forEach(s=>{const i=s.querySelector('input[type="radio"]');i&&i.checked&&e.push(s)}),e.length==0&&this.clotherInfo?.data)return this.clotherInfo.data.size.arrayValue.values[0].stringValue;const o=e[0].textContent?.trim().replace(/[\s]+$/,"");return console.log(o),o}count(){const t=n("#buttonCountNumber")?.innerText,e=n("#calculation")?.innerText;return[t,e]}renderCart(){if(c){if(c.innerHTML="",this.cart.length===0){const t=a("p","empty-cart-message");t.textContent="Your bag is empty.",c?.appendChild(t)}else this.cart.forEach(t=>{const e=a("div","prod-in-bag"),o=a("a",["clother",t.id,t.size]);o.href=`one-product.html?id=${t.id}`;const s=a("div","clother__img");s.innerHTML=`
          <picture>
            <source srcset=${t.data.imgWebP.stringValue} type="image/webp" />
            <img src=${t.data.img.stringValue} />
          </picture>
        `;const i=a("div","clother__info"),r=a("p","clother__name");r.textContent=t.data.name.stringValue;const h=a("p","clother__size");h.innerHTML=`Size: <span>${t.size}</span>`;const u=a("p","clother__art");u.innerHTML=`
          Art.No.: <span>434536465<span>
        `;const m=a("p","clother__count");m.innerHTML=`
          ${t.quantity} x ${(t.price/t.quantity).toFixed(2)} EUR
        `;const f=a("div","clother__remove");f.innerHTML=`
          <svg>
            <use href="#remove"></use>
          </svg>
        `,i.appendChild(r),i.appendChild(h),i.appendChild(u),i.appendChild(m),o.appendChild(s),o.appendChild(i),e.appendChild(o),e.appendChild(f),c.appendChild(e),this.removeClother(e,t)});this.updateTotal()}}removeClother(t,e){const o=t.querySelector(".clother__remove");o&&o.addEventListener("click",()=>{this.cart=this.cart.filter(s=>s.id!==e.id||s.size!==e.size),t.remove(),this.saveCart(),this.updateTotal(),console.log("Item removed:",e)})}updateTotal(){const t=this.cart.reduce((e,o)=>e+o.price,0);C&&(C.textContent=t.toFixed(2)),console.log(t)}saveCart(){localStorage.setItem("shoppingCart",JSON.stringify(this.cart))}loadCart(){const t=localStorage.getItem("shoppingCart");return t?JSON.parse(t):[]}}class L{popup;popupWrapper;constructor(t,e){this.popupWrapper=n(t),this.popup=n(e,this.popupWrapper),this.init()}init(){console.log(this.popup),document.addEventListener("click",this.handleClickOutside)}handleClickOutside=t=>{this.popup&&!this.popupWrapper.contains(t.target)&&this.popup.classList.contains("active")&&this.popup.classList.remove("active")}}export{_ as A,L as P,I as S};
