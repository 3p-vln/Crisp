import{a as l,g as d,f as h,r as i}from"./useFetch-DucEEeGt.js";const p=l(".search");class f{prodArr;constructor(){this.prodArr=[],this.init()}init(){this.openSearch()}openSearch(){p.forEach(e=>{window.innerWidth<1024&&e.classList.contains("mob")?e.querySelector("svg")?.addEventListener("click",()=>{e.classList.toggle("active"),console.log("click"),d(".burger-btn")?.classList.toggle("hidden"),d(".header__logo")?.classList.toggle("hidden"),d(".buy__bag")?.classList.toggle("hidden"),this.addPopUp(e),this.getData(),this.getFilteredItems(),e.querySelector("::before")?.addEventListener("click",()=>{e.classList.remove("active"),d(".burger-btn")?.classList.remove("hidden"),d(".header__logo")?.classList.remove("hidden"),d(".buy__bag")?.classList.remove("hidden")})}):e.classList.contains("mob")||e.addEventListener("click",()=>{e.classList.toggle("active"),this.addPopUp(e),this.getData(),this.getFilteredItems()})})}async getData(){const e={projectId:"crisp-b06bf"},t={structuredQuery:{from:[{collectionId:"clothers"}]}},r=`https://firestore.googleapis.com/v1/projects/${e.projectId}/databases/(default)/documents:runQuery`,s=await h(r,{method:"POST",body:t});if(s.error){console.error("Ошибка при загрузке данных:",s.error);return}if(s.data){s.data.forEach(o=>{const n=o.document.name.split("/").pop()||"";this.prodArr.push({id:n,data:o.document.fields})}),console.log(this.prodArr);const a=d(".search__popup.pop-up");a&&this.renderCards(a)}}addPopUp(e){const t=d(".search__popup.pop-up");if(!t){const r=i("div",["search__popup","pop-up","active"]);e.appendChild(r)}t?.classList.toggle("active")}renderCards(e){this.prodArr.forEach(t=>{const r=i("a",["card",t.id]);r.href=`one-product.html?id=${t.id}`;const s=i("div","card__img");s.innerHTML+=`
            <picture>
              <source srcset=${t.data.imgWebP.stringValue} type="image/webp" />
              <img src=${t.data.img.stringValue} />
            </picture>
      `;const a=i("div","card__info"),o=i("h3","card__title");o.innerText=t.data.name.stringValue;const n=i("p","card__price");n.innerText=t.data.cost.stringValue,a.appendChild(o),a.appendChild(n),r.appendChild(s),r.appendChild(a),e.appendChild(r)})}filter(e,t){return t.filter(r=>{const s=new RegExp(e,"gi");return r.data.name.stringValue.match(s)})}getFilteredItems(){p.forEach(e=>{if(e.classList.contains("active")){const t=e.querySelector("input");console.log(t),t?.addEventListener("input",()=>{const r=this.filter(t.value,this.prodArr),s=d(".search__popup.pop-up");s&&(this.clearContainer(s),this.renderFilteredCards(s,r))})}})}clearContainer(e){for(;e.firstChild;)e.removeChild(e.firstChild)}renderFilteredCards(e,t){t.forEach(r=>{const s=i("a",["card",r.id]);s.href=`one-product.html?id=${r.id}`;const a=i("div","card__img");a.innerHTML+=`
            <picture>
              <source srcset=${r.data.imgWebP.stringValue} type="image/webp" />
              <img src=${r.data.img.stringValue} />
            </picture>
      `;const o=i("div","card__info"),n=i("h3","card__title");n.innerText=r.data.name.stringValue;const c=i("p","card__price");c.innerText=r.data.cost.stringValue,o.appendChild(n),o.appendChild(c),s.appendChild(a),s.appendChild(o),e.appendChild(s)})}}export{f as S};
