import{g as a,a as h,f as l,r as i,B as D,A as T,S as B}from"./search-DP2q2jjU.js";import{L as p}from"./stop-preload-lHMBXtTV.js";import{A as S,P as U,S as V}from"./pop-up-closer-DNyzttUJ.js";import{S as y,A as $}from"./autoplay-CXgkKXRk.js";import{P}from"./pagination-ci0mCzHu.js";import{T as k}from"./tabs-C4AD9RJJ.js";import{L as M}from"./you-may-also-like-BnNfyhzk.js";y.use([P,$]);const d=a(".main-img__swiper-wrapper"),u=a(".main-info__all-img");class A{swiper;slidesArr;constructor(){this.swiper=null,this.slidesArr=null,this.init().then(()=>p.stop("main-info__tabs"))}async init(){this.conectDb()}initSwiper(){if(h(".main-img__slide").length>1)this.swiper=new y(".main-img__swiper",{slidesPerView:1,autoplay:{delay:1e4},pagination:{el:".swiper-pagination"},grabCursor:!0,on:{slideChange:()=>this.onSlideChange()}}),this.initTabsSync();else{const n=a(".main-img__swiper");n&&n.classList.remove("swiper-container-initialized","swiper-container-horizontal")}}initTabsSync(){h(".tabs__nav-btn").forEach((n,o)=>{n.addEventListener("click",()=>{console.log(`Tab ${o+1} clicked`),this.swiper&&this.swiper.slideTo(o)})})}onSlideChange(){h(".tabs__nav-btn").forEach((n,o)=>{this.swiper&&o===this.swiper.realIndex?n.classList.add("tabs__nav-btn_active"):n.classList.remove("tabs__nav-btn_active")})}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const o=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,e=await l(o,{method:"GET"});if(e.error){console.error("Error fetching document:",e.error);return}e.data&&(this.slidesArr=e.data.fields,console.log(this.slidesArr),this.renderSlides(),this.initSwiper(),p.stop("main-img__slide"),p.stop("tabs__nav-btn"),new k)}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}renderSlides(){if(d&&u&&this.slidesArr){const{img:t,subImg1:n,subImg2:o,subImgWebP1:e,subImgWebP2:r}=this.slidesArr;if(t&&n&&o&&e&&r){const s=i("button",["tabs__nav-btn","tabs__nav-btn_active","skeleton"]);s.type="button",s.dataset.tab="#slide-1",s.innerHTML=`
          <img src="${t.stringValue}" />
        `;const c=i("button",["tabs__nav-btn","skeleton"]);c.type="button",c.dataset.tab="#slide-2",c.innerHTML=`
          <img src="${n.stringValue}" />
        `;const f=i("button",["tabs__nav-btn","skeleton"]);f.type="button",f.dataset.tab="#slide-3",f.innerHTML=`
          <img src="${o.stringValue}" />
        `,u.appendChild(s),u.appendChild(c),u.appendChild(f);const w=i("div",["main-img__slide","swiper-slide","tabs__item","tabs__item_active","skeleton"]);w.id="slide-1",w.innerHTML=`
          <img src="${t.stringValue}" />
        `;const _=i("div",["main-img__slide","swiper-slide","tabs__item","skeleton"]);_.id="slide-2",_.innerHTML=`
          <img src="${n.stringValue}" />
        `;const C=i("div",["main-img__slide","swiper-slide","tabs__item","skeleton"]);C.id="slide-3",C.innerHTML=`
          <img src="${o.stringValue}" />
        `,d.appendChild(w),d.appendChild(_),d.appendChild(C)}else if(t?.stringValue!=null){const s=i("button",["tabs__nav-btn","tabs__nav-btn_active","skeleton"]);s.type="button",s.dataset.tab="#slide-1",s.innerHTML=`
          <img src="${t.stringValue}" />
        `,u.appendChild(s);const c=i("div",["main-img__slide","swiper-slide","tabs__item","tabs__item_active"]);c.id="slide-1",c.innerHTML=`
          <img src="${t.stringValue}" />
        `,d.appendChild(c)}}}}class j{calculation;countElement;calculationElement;buttonCountPlus;buttonCountMinus;clotherInfo;constructor(){this.clotherInfo=null,this.calculationElement=document.getElementById("calculation"),this.countElement=document.getElementById("buttonCountNumber"),this.buttonCountPlus=document.getElementById("buttonCountPlus"),this.buttonCountMinus=document.getElementById("buttonCountMinus"),this.calculation=0,this.buttonCountPlus.onclick=this.incrementCount.bind(this),this.buttonCountMinus.onclick=this.decrementCount.bind(this),this.conectDb()}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const o=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,e=await l(o,{method:"GET"});if(e.error){console.error("Error fetching document:",e.error);return}if(e.data&&(this.clotherInfo=e.data.fields,console.log(this.clotherInfo),this.clotherInfo.cost?.stringValue)){const r=this.clotherInfo.cost.stringValue,s=parseFloat(r.replace(",","."));isNaN(s)||(this.calculation=s,this.updateCalculation(+this.countElement.innerHTML))}}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}incrementCount(){let t=+this.countElement.innerHTML;t<999&&(t++,this.countElement.innerHTML=t.toString(),this.updateCalculation(t))}decrementCount(){let t=+this.countElement.innerHTML;t>1&&(t--,this.countElement.innerHTML=t.toString(),this.updateCalculation(t))}updateCalculation(t){const n=this.calculation*t;this.calculationElement.innerHTML=this.formatPrice(n)}formatPrice(t){return t.toFixed(2).replace(".",",")}}class R{dropdownBtn;dropdownList;dropdownBtnInfo;radioButtons;constructor(t){this.dropdownBtn=a(`${t} .dropdown__btn`),this.dropdownList=a(`${t} .dropdown__list`),this.dropdownBtnInfo=this.dropdownBtn.querySelector(".dropdown__btn_info"),this.radioButtons=this.dropdownList.querySelectorAll('input[type="radio"]'),this.init()}init(){this.dropdownBtn.addEventListener("click",()=>this.toggleDropdown()),this.radioButtons.forEach(t=>t.addEventListener("change",()=>this.updateDropdown(t))),window.addEventListener("resize",()=>this.checkScreenWidth()),this.checkScreenWidth()}toggleDropdown(){this.dropdownList.classList.toggle("active"),this.dropdownBtn.classList.toggle("active")}updateDropdown(t){const n=t.parentElement;if(console.log("Radio changed:",t),console.log("Parent label:",n),n){const o=n.textContent?.trim().replace(/[\s]+$/,"")??"Size";console.log("Label text content:",o),this.dropdownBtnInfo.textContent=o}else this.dropdownBtnInfo.textContent="Size";this.dropdownList.classList.remove("active"),this.dropdownBtn.classList.remove("active")}checkScreenWidth(){window.innerWidth>1024?(this.dropdownList.classList.add("active"),this.dropdownBtn.classList.add("active")):(this.dropdownList.classList.remove("active"),this.dropdownBtn.classList.remove("active"))}}const g=a(".info__brand p"),b=a(".info__title"),I=h(".info__color-btns"),L=h(".sizes__list label"),v=a(".price__total span");class z{clotherInfo;constructor(){this.clotherInfo=null,this.init().then(()=>p.stop("main-info__info"))}async init(){this.conectDb()}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const o=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,e=await l(o,{method:"GET"});if(e.error){console.error("Error fetching document:",e.error);return}e.data&&(this.clotherInfo=e.data.fields,console.log(this.clotherInfo),this.updateUI())}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}updateUI(){this.brandAndTitle(),this.colors(),this.size(),this.price()}brandAndTitle(){g&&b&&(this.clotherInfo?(g.textContent=this.clotherInfo.brand?.stringValue||"No brand",b.textContent=this.clotherInfo.name?.stringValue||"No title",console.log(g,b)):(g.textContent="No brand",b.textContent="No title"))}colors(){this.clotherInfo?.color?.arrayValue?.values&&this.clotherInfo.color.arrayValue.values.forEach(t=>{I&&I.forEach(n=>{const o=i("div",["color",`color__${t.stringValue}`]),e=i("input",null);e.type="radio",e.name="color",e.id=t.stringValue;const r=i("div","custom-radio");o.appendChild(e),o.appendChild(r),n.appendChild(o)})})}size(){this.clotherInfo?.size?.arrayValue?.values&&(console.log("Sizes from Firestore:",this.clotherInfo.size.arrayValue.values),this.clotherInfo.size.arrayValue.values.forEach(t=>{const n=t.stringValue?.trim();n&&L&&L.forEach(o=>{o.textContent?.trim()===n&&o.classList.remove("no-size")})}))}price(){if(v&&this.clotherInfo?.cost?.stringValue){const n=this.clotherInfo.cost.stringValue.split(" ")[0];v.textContent=n}}}const E=a(".bag__save");class H{uid;currentUser;currentClother;constructor(){this.currentUser=null,this.uid=this.getCookie("UID"),this.currentClother=null,this.init()}init(){E&&E.addEventListener("click",()=>{this.conectUserDb()})}getCookie(t){const o=`; ${document.cookie}`.split(`; ${t}=`);if(o.length===2)return o.pop()?.split(";").shift()}async conectUserDb(){if(!this.uid){console.error("UID not found"),window.location.href="/Crisp/sign-in.html";return}const t={projectId:"crisp-b06bf"},n={structuredQuery:{from:[{collectionId:"users"}],where:{fieldFilter:{field:{fieldPath:"uid"},op:"EQUAL",value:{stringValue:this.uid}}}}},o=`https://firestore.googleapis.com/v1/projects/${t.projectId}/databases/(default)/documents:runQuery`;try{const e=await l(o,{method:"POST",body:n});if(e.error){console.error("Error fetching data:",e.error);return}if(e.data&&e.data.length>0){const r=e.data[0];if(r.document&&r.document.fields){const s=r.document.name.split("/").pop()||"";this.currentUser={id:s,data:r.document.fields}}console.log(this.currentUser),this.getCurrentClotherDB()}}catch(e){console.error("Error fetching data:",e)}}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}async getCurrentClotherDB(){if(this.currentUser?.data.wishlistID){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const o=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,e=await l(o,{method:"GET"});if(e.error){console.error("Error fetching document:",e.error);return}e.data&&(this.currentClother={id:t,data:e.data.fields},console.log(this.currentClother),this.addToWishlistDb())}}async addToWishlistDb(){if(!this.currentUser||!this.currentClother){console.error("Current user or clothing item is not defined");return}const n=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/all-wishlist/${this.currentUser.data.shoppingAddress?.stringValue}/wishlist/${this.currentClother.id}`;console.log(n);const o={fields:{name:this.currentClother.data.name,cost:this.currentClother.data.cost,img:this.currentClother.data.img,imgWebP:this.currentClother.data.imgWebP}};try{const e=await l(n,{method:"PATCH",body:o});if(e.error){console.error("Error adding document:",e.error);return}e.data&&console.log("Document written with ID:",e.data.name)}catch(e){console.error("Error adding document:",e)}}}document.addEventListener("DOMContentLoaded",async()=>{new D,new T,new S,new A,new j,new R(".info__sizes"),new z,new M,p.stop("more-info"),new B,new H,new U(".buy__bag",".bag__list")});new V;
