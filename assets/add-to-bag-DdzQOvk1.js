import{a as d,g as n,f as b,r as i}from"./search-CNxuQHz5.js";class _{allSkeleton;constructor(){this.allSkeleton=d(".skeleton"),this.removeSkeleton()}removeSkeleton(){document.addEventListener("loadingIsFinished",t=>{this.allSkeleton=d(".skeleton");let e=0;if(t.detail){const s=document.querySelectorAll("."+t.detail.block+" img");s.length==0&&this.removeClassname(t),s.forEach(o=>{o.complete&&(e+=1,t.detail?.requiredImagesCount&&e>=t.detail.requiredImagesCount&&this.removeClassname(t)),o.onload=()=>{e+=1,t.detail?.requiredImagesCount&&e>=t.detail.requiredImagesCount&&this.removeClassname(t)}})}})}removeClassname(t){this.allSkeleton.forEach(e=>{t.detail?.block&&e.classList.contains(t.detail.block)&&e.classList.remove("skeleton")})}}const f=n(".bag__add.btn.black"),l=n(".bag__list"),c=n(".pop-up__list"),g=n(".summ span span");class v{clotherInfo;cart;constructor(){this.clotherInfo=null,this.cart=this.loadCart(),this.init()}init(){f&&f.addEventListener("click",()=>{this.conectDb()}),this.renderCart()}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("id")}async conectDb(){const t=this.getDocumentIdFromURL();if(!t){console.error("Document ID not found in URL");return}const s=`https://firestore.googleapis.com/v1/projects/${{projectId:"crisp-b06bf"}.projectId}/databases/(default)/documents/clothers/${t}`,o=await b(s,{method:"GET"});if(o.error){console.error("Error fetching document:",o.error);return}o.data&&(this.clotherInfo={id:t,data:o.data.fields},console.log(this.clotherInfo),this.addToList())}addToList(){if(this.clotherInfo&&l){const t=this.clotherInfo.id,e=this.selectedSize(),s=parseFloat(this.clotherInfo.data.cost.stringValue.replace(",",".")),o=Number(this.count()[0]),a=this.cart.find(r=>r.id===t&&r.size===e);l.classList.contains("active")||l.classList.add("active"),a?(a.quantity+=o,a.price+=s*o):this.cart.push({id:t,size:e,quantity:o,price:s*o,data:this.clotherInfo.data}),this.saveCart(),this.renderCart()}}selectedSize(){const t=d(".sizes__list label"),e=[];if(t&&t.forEach(o=>{const a=o.querySelector('input[type="radio"]');a&&a.checked&&e.push(o)}),e.length==0&&this.clotherInfo?.data)return this.clotherInfo.data.size.arrayValue.values[0].stringValue;const s=e[0].textContent?.trim().replace(/[\s]+$/,"");return console.log(s),s}count(){const t=n("#buttonCountNumber")?.innerText,e=n("#calculation")?.innerText;return[t,e]}renderCart(){if(c){if(c.innerHTML="",this.cart.length===0){const t=i("p","empty-cart-message");t.textContent="Your bag is empty.",c?.appendChild(t)}else this.cart.forEach(t=>{const e=i("div","prod-in-bag"),s=i("a",["clother",t.id,t.size]);s.href=`one-product.html?id=${t.id}`;const o=i("div","clother__img");o.innerHTML=`
          <picture>
            <source srcset=${t.data.imgWebP.stringValue} type="image/webp" />
            <img src=${t.data.img.stringValue} />
          </picture>
        `;const a=i("div","clother__info"),r=i("p","clother__name");r.textContent=t.data.name.stringValue;const h=i("p","clother__size");h.innerHTML=`Size: <span>${t.size}</span>`;const p=i("p","clother__art");p.innerHTML=`
          Art.No.: <span>434536465<span>
        `;const u=i("p","clother__count");u.innerHTML=`
          ${t.quantity} x ${(t.price/t.quantity).toFixed(2)} EUR
        `;const m=i("div","clother__remove");m.innerHTML=`
          <svg>
            <use href="#remove"></use>
          </svg>
        `,a.appendChild(r),a.appendChild(h),a.appendChild(p),a.appendChild(u),s.appendChild(o),s.appendChild(a),e.appendChild(s),e.appendChild(m),c.appendChild(e),this.removeClother(e,t)});this.updateTotal()}}removeClother(t,e){const s=t.querySelector(".clother__remove");s&&s.addEventListener("click",()=>{this.cart=this.cart.filter(o=>o.id!==e.id||o.size!==e.size),t.remove(),this.saveCart(),this.updateTotal(),console.log("Item removed:",e)})}updateTotal(){const t=this.cart.reduce((e,s)=>e+s.price,0);g&&(g.textContent=t.toFixed(2)),console.log(t)}saveCart(){localStorage.setItem("shoppingCart",JSON.stringify(this.cart))}loadCart(){const t=localStorage.getItem("shoppingCart");return t?JSON.parse(t):[]}}export{v as A,_ as S};
